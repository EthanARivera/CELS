<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <title>Gestor de Materiales</title>
    <h:outputStylesheet name="style.css"/>
    <script src="resources/funct.js"></script>
</h:head>
<h:body>
    <!-- Encabezado con botones -->
    <div class="header">
        <!-- Link para regresar -->
        <h:link outcome="index.xhtml" styleClass="back ui-button-success">
            <i class="pi pi-arrow-left"></i>
        </h:link>

        <span>Gestor de materiales</span>

        <!-- Botón de menú -->
        <p:commandButton class="menu" icon="pi pi-bars"
                         onclick="toggleMenu(); return false;" />
    </div>

    <!-- Menú superior oculto -->
    <div id="menuPanel" class="menu-panel">
        <h:link outcome="consulta_materiales.xhtml" styleClass="menu-option">
        <i class="pi pi-box"></i> Consulta Materiales
    </h:link>

        <h:link outcome="consulta_usuarios.xhtml" styleClass="menu-option">
            <i class="pi pi-users"></i> Consulta Usuarios
        </h:link>

        <h:link outcome="consulta_cotizaciones.xhtml" styleClass="menu-option">
            <i class="pi pi-file"></i> Consulta Cotizaciones
        </h:link>
    </div>

    <!-- Nos permite usar TipoUnidad -->


    <h:form id="formMateriales" styleClass="cuerpo-gestores">

        <!-- Panel principal del catálogo -->
        <p:panel styleClass="catalogo-panel">
            <br/>
            <!-- Barra de búsqueda -->
            <div class="searchbar">
                <i class="pi pi-search">    </i>

                <p:inputText id="nombreBusqueda"
                             value="#{materialBean.nombreBusqueda}"
                             placeholder="Buscar por nombre"
                             styleClass="search-input">
                    <p:ajax event="keyup"
                            process="@form"
                            listener="#{materialBean.aplicarFiltro}"
                            update="tablaMateriales"
                            delay="500"/>
                </p:inputText>

                <i class="pi pi-search">    </i>
                <p:inputText id="idBusqueda"
                             value="#{materialBean.idBusqueda}"
                             placeholder="Buscar por ID"
                             styleClass="search-input"
                             style="margin-left:10px;">
                    <p:ajax event="keyup"
                            process="@form"
                            listener="#{materialBean.aplicarFiltro}"
                            update="tablaMateriales"
                            delay="100"/>
                </p:inputText>

                <br/><br/>

                <p:commandButton value="Mostrar todos"
                                 icon="pi pi-refresh"
                                 actionListener="#{materialBean.recargarMateriales}"
                                 update="tablaMateriales"
                                 styleClass="btn-azul-iconoblanco btn-refresh"/>
            </div>

            <br/><br/>

            <!-- Tabla de materiales -->
            <p:dataTable id="tablaMateriales"
                         value="#{materialBean.listaFiltrada}"
                         var="material"
                         responsiveLayout="scroll"
                         emptyMessage="Sin materiales registrados"
                         rowHover="true"
                         paginator="false"
                         styleClass="ua-table custom-table-skin">

                <p:column headerText="ID" style="width:80px;">
                    <h:outputText value="#{material.id}" />
                </p:column>

                <p:column headerText="Nombre material">
                    <h:outputText value="#{material.nombre}" />
                </p:column>

                <p:column headerText="Tipo de material">
                    <h:outputText value="#{material.tipoMaterial}" />
                </p:column>

                <p:column headerText="Costo">
                    <h:outputText value="#{material.costo}" />
                </p:column>

                <p:column headerText="Tipo de unidad">
                    <h:outputText value="#{material.tipoUnidad}" />
                </p:column>

                <p:column headerText="Acciones"
                          style="width:100px; text-align:center;">
                    <div class="action-buttons">
                        <p:commandButton icon="pi pi-pencil"
                                         title="Editar"
                                         styleClass="ui-button-flat pencil-icon"
                                         actionListener="#{materialBean.prepararEdicion(material)}"
                                         update=":formEditar"
                                         oncomplete="PF('dlgEditar').show()"
                                         />
                        <p:commandButton icon="pi pi-trash"
                                         title="Eliminar"
                                         styleClass="ui-button-flat delete-icon"
                                         actionListener="#{materialBean.eliminarMaterial(material)}"
                                         update=":formMateriales:tablaMateriales growl">
                            <p:confirm header = "Confirmar eliminación"
                                       message="¿Estás seguro de eliminar el material '#{material.nombre}'?"
                                       icon ="pi pi-exclamation-triangle"/>
                        </p:commandButton>
                    </div>
                </p:column>
            </p:dataTable>

        </p:panel>

        <!-- Mensajes para eliminación de materiales-->
        <p:growl id="growl" showDetail="true" life="4000" />

        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade" width="350" columnClasses="label-column, input-column">
            <div style="display: flex; justify-content: center; gap: 10px;">
            <p:commandButton value="Sí" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
            <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
            </div>
        </p:confirmDialog>

    </h:form>
    <!--Ventana para editar el material-->
    <p:dialog header="Editar Material" widgetVar="dlgEditar"
              modal="true" resizable="false" width="450">
        <h:form id="formEditar">
            <h:panelGrid columns="2" cellpadding="5" style="width:100%"
                         columnClasses="label-column, input-column">

                <h:outputLabel value="ID:" />
                <h:inputText value="#{materialBean.materialSeleccionado.id}" disabled="true" style="width:100%"/>

                <h:outputLabel value="Nombre:" />
                <h:inputText value="#{materialBean.materialSeleccionado.nombre}" disabled="true" style="width:100%"/>

                <h:outputLabel value="Tipo de material:" />
                <h:inputText value="#{materialBean.materialSeleccionado.tipoMaterial}" disabled="true" style="width:100%"/>

                <h:outputLabel value="Costo:" />
                <p:inputNumber value="#{materialBean.materialSeleccionado.costo}"
                               symbol=" $" symbolPosition="s"
                               decimalPlaces="2"
                               required="true"
                               minValue="0"
                               inputStyle="width:100%"/>

                <h:outputLabel value="Tipo de unidad:" />
                <h:inputText id="tipoUnidad"
                             value="#{materialBean.materialSeleccionado.tipoUnidad}"
                             disabled="true"
                             style="width:100%"
                />
            </h:panelGrid>
            <br/>
            <div style="text-align:center; margin-top:10px;">
                <p:commandButton value="Guardar"
                                 icon="pi pi-save"
                                 actionListener="#{materialBean.guardarCambios}"
                                 update=":formMateriales:tablaMateriales"
                                 oncomplete="PF('dlgEditar').hide();"
                                 styleClass="btn-azul-iconoblanco"/>
                <p:commandButton value="Cancelar"
                                 icon="pi pi-times"
                                 type="button"
                                 onclick="PF('dlgEditar').hide();"
                                 styleClass="btn-rojo-iconoblanco"/>

            </div>


        </h:form>
    </p:dialog>


</h:body>

</html>
